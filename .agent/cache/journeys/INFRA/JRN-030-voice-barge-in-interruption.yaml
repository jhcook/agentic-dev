# Journey: JRN-030
# Linked Story: INFRA-035
# Title: Voice Barge-In and Interruption Handling

id: JRN-030
title: Voice Barge-In and Interruption Handling
state: COMMITTED
schema_version: 1
priority: medium
tags:
- infra
- voice
actor: developer using voice assistant
description: Implement "Barge-in" capability for the Voice Agent. This requires Voice Activity Detection (VAD) to recognize
  when the user starts speaking while the agent is talking, and an Interrupt Handler to immediately stop audio playback and
  update the conversation context.
preconditions:
- Agent CLI is installed and configured
- Developer is in a project directory with .agent/ initialized
auth_context:
  level: public
  permissions: []
steps:
- id: 1
  action: Developer starts voice session via WebSocket or admin console
  system_response: Voice agent initializes STT/TTS pipeline
  assertions:
  - WebSocket connection established
  - Audio pipeline ready
- id: 2
  action: Developer speaks a command or question
  system_response: System transcribes speech, processes intent, generates response
  assertions:
  - Transcription is accurate
  - Response is relevant
- id: 3
  action: Developer receives spoken response
  system_response: TTS converts response to speech, streams audio back
  assertions:
  - Audio plays clearly
  - Latency is acceptable
error_paths:
- trigger_step: 1
  condition: Missing configuration or prerequisites
  system_response: CLI displays clear error with remediation steps
  assertions:
  - Error message is actionable
  severity: expected
edge_cases:
- scenario: Command run with no network access
  expected: Graceful degradation or clear offline error
  severity: warning
data_state:
  data_classification: internal
  inputs: []
  persistent: []
linked_stories:
- INFRA-035
linked_adrs: []
depends_on: []
implementation:
  routes: []
  files:
  - tests/test_interrupt.py
  - tests/test_vad.py
  tests: []
