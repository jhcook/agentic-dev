id: JRN-032
title: Additional Voice Providers Google and Azure
state: COMMITTED
schema_version: 1
priority: medium
tags:
- infra
- voice
actor: developer using voice assistant
description: Implement support for Google Cloud Speech and Azure Cognitive Services
  as additional voice providers in the platform. This includes STT and TTS implementations
  for both providers, factory updates for selection, configuration updates for credentials,
  and observability improvements.
preconditions:
- Agent CLI is installed and configured
- Developer is in a project directory with .agent/ initialized
auth_context:
  level: authenticated
  permissions: []
steps:
- id: 1
  action: Developer starts voice session via WebSocket or admin console
  system_response: Voice agent initializes STT/TTS pipeline
  assertions:
  - WebSocket connection established
  - Audio pipeline ready
- id: 2
  action: Developer speaks a command or question
  system_response: System transcribes speech, processes intent, generates response
  assertions:
  - Transcription is accurate
  - Response is relevant
- id: 3
  action: Developer receives spoken response
  system_response: TTS converts response to speech, streams audio back
  assertions:
  - Audio plays clearly
  - Latency is acceptable
error_paths:
- trigger_step: 1
  condition: Missing configuration or prerequisites
  system_response: CLI displays clear error with remediation steps
  assertions:
  - Error message is actionable
  severity: expected
edge_cases:
- scenario: Command run with no network access
  expected: Graceful degradation or clear offline error
  severity: warning
data_state:
  data_classification: internal
  inputs: []
  persistent: []
linked_stories:
- INFRA-037
linked_adrs: []
depends_on: []
implementation:
  routes: []
  files:
  - .agent/etc/voice.yaml
  - .agent/pyproject.toml
  - .agent/src/agent/commands/onboard.py
  - .agent/src/backend/routers/voice.py
  - .agent/src/backend/speech/factory.py
  - .agent/src/backend/speech/providers/azure.py
  - .agent/src/backend/speech/providers/google.py
  - .agent/src/backend/voice/orchestrator.py
  - .agent/src/backend/voice/vad.py
  - .agent/src/web/package-lock.json
  - .agent/src/web/package.json
  - .agent/src/web/tsconfig.app.json
  - .agent/src/web/tsconfig.json
  - .agent/src/web/tsconfig.node.json
  tests:
  - .agent/tests/admin/test_admin_config.py
  - .agent/tests/admin/test_admin_governance.py
  - .agent/tests/admin/test_cli.py
  - .agent/tests/cli/test_cli_options.py
  - .agent/tests/cli/test_onboard_e2e.py
  - .agent/tests/cli/test_onboard_unit.py
  - .agent/tests/commands/test_config_command.py
  - .agent/tests/core/test_ai_provider.py
  - .agent/tests/core/test_ai_service.py
  - .agent/tests/core/test_anthropic_provider.py
  - .agent/tests/core/test_count_tokens.py
  - .agent/tests/core/test_governance_core.py
  - .agent/tests/core/test_list_models.py
  - .agent/tests/core/test_mcp_client.py
  - .agent/tests/integration/test_agent_integration.py
  - .agent/tests/integration/test_python_agent.py
  - .agent/tests/journeys/test_jrn_032.py
  - .agent/tests/sync/test_sync_behaviors.py
  - .agent/tests/sync/test_sync_db.py
  - .agent/tests/sync/test_sync_ops.py
  - .agent/tests/voice/test_interrupt.py
  - .agent/tests/voice/test_local_tts.py
  - .agent/tests/voice/test_sentence_buffer.py
  - .agent/tests/voice/test_vad.py
  - .agent/tests/voice/test_voice_flow.py
  - .agent/tests/voice/test_voice_flow_streaming.py
  - .agent/tests/voice/test_voice_tools.py
