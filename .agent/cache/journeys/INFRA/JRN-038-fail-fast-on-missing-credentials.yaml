id: JRN-038
title: Fail Fast on Missing Credentials
state: COMMITTED
schema_version: 1
priority: medium
tags:
- infra
- cli
actor: developer using agent CLI
description: Create a "fail fast" mechanism that verifies the presence of necessary
  credentials during runtime for commands requiring authentication (e.g., admin console,
  AI integrations). If credentials are missing, the system should exit gracefully
  with an actionable and secure error message. The mechanism must ensure no sensitive
  information is exposed, maintain compliance with governance rules, and enhance usability
  without disrupting unrelated functionalities.
preconditions:
- Agent CLI is installed and configured
- Developer is in a project directory with .agent/ initialized
auth_context:
  level: authenticated
  permissions: []
steps:
- id: 1
  action: Developer runs `agent admin start`
  system_response: CLI processes the start request
  assertions:
  - Command exits with status 0
  - Expected output displayed
- id: 2
  action: Developer runs `agent onboard`
  system_response: CLI processes the onboard request
  assertions:
  - Command exits with status 0
  - Expected output displayed
- id: 3
  action: Developer runs `agent version`
  system_response: CLI processes the version request
  assertions:
  - Command exits with status 0
  - Expected output displayed
error_paths:
- trigger_step: 1
  condition: Missing configuration or prerequisites
  system_response: CLI displays clear error with remediation steps
  assertions:
  - Error message is actionable
  severity: expected
edge_cases:
- scenario: Command run with no network access
  expected: Graceful degradation or clear offline error
  severity: warning
data_state:
  data_classification: internal
  inputs: []
  persistent: []
linked_stories:
- INFRA-044
linked_adrs: []
depends_on: []
implementation:
  routes: []
  files:
  - .agent/src/agent/commands/admin.py
  - .agent/src/agent/commands/check.py
  - .agent/src/agent/commands/implement.py
  - .agent/src/agent/core/ai/prompts.py
  - .agent/src/agent/core/ai/service.py
  - .agent/src/agent/core/auth/__init__.py
  - .agent/src/agent/core/auth/credentials.py
  - .agent/src/agent/core/auth/errors.py
  - .agent/src/agent/core/config.py
  - .agent/src/agent/core/fixer.py
  - .agent/src/agent/main.py
  tests:
  - .agent/src/agent/core/auth/tests/test_regression_credentials.py
  - .agent/src/agent/core/auth/tests/test_validate_credentials.py
  - .agent/tests/journeys/test_jrn_038.py
